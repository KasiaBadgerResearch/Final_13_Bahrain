# How have gender disparities in educational attainment, measured by the percentage of the population aged 15 and above with no formal education, evolved in Bahrain between 1960 and 2010?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "education_bhr_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Bahrain dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the two indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Barro-Lee: Percentage of female population age 15+ with no education"], 
         marker='o', linestyle='-', label="Percentage of female population age 15+ with no education")
plt.plot(df_plot["Year"], df_plot["Barro-Lee: Percentage of population age 15+ with no education"], 
         marker='o', linestyle='-', label="Percentage of population age 15+ with no education")

plt.title("Bahrain: Female Population without Education vs Total Population without Education (%) (1960-2010)")
plt.xlabel("Year")
plt.ylabel("Percentage")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "bahrain_female_pop_without_edu_vs_total_pop_without_edu.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "bahrain_female_pop_without_edu_vs_total_pop_without_edu"), index=False)
